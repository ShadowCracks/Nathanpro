import{r as n,b as x,j as e}from"./index-C_XptwtU.js";const T=()=>{const[i,b]=n.useState("overview"),[u,N]=n.useState([]),[w,k]=n.useState(0),[d,j]=n.useState([]),[C,m]=n.useState(!1),[v,h]=n.useState(null),[a,c]=n.useState({title:"",description:"",youtubeUrl:"",moduleId:null}),o=localStorage.getItem("adminId");n.useEffect(()=>{if(!o){window.location.href="/admin/login";return}y()},[o]);const y=async()=>{m(!0);try{const s=await x.get("https://nathanpro.onrender.com/api/admin/users",{headers:{"admin-id":o}});N(s.data.users);const t=await x.get("https://nathanpro.onrender.com/api/admin/ebook-stats",{headers:{"admin-id":o}});k(t.data.downloads);const r=await x.get("https://nathanpro.onrender.com/api/admin/course/modules",{headers:{"admin-id":o}});j(r.data.modules)}catch(s){h("Failed to fetch dashboard data"),console.error(s)}finally{m(!1)}},M=async s=>{var t;s.preventDefault(),m(!0);try{const r=a.moduleId?((t=d.find(l=>l.id===a.moduleId))==null?void 0:t.order_index)||0:d.length;await x.post("https://nathanpro.onrender.com/api/admin/course/module",{...a,orderIndex:r},{headers:{"admin-id":o}}),c({title:"",description:"",youtubeUrl:"",moduleId:null}),y()}catch{h("Failed to save module")}finally{m(!1)}},I=async s=>{if(confirm("Are you sure you want to delete this module?"))try{await x.delete(`https://nathanpro.onrender.com/api/admin/course/module/${s}`,{headers:{"admin-id":o}}),y()}catch{h("Failed to delete module")}},f=async(s,t)=>{const r=d.findIndex(g=>g.id===s);if(r===-1)return;const l=t==="up"?r-1:r+1;if(l<0||l>=d.length)return;const p=[...d],[_]=p.splice(r,1);p.splice(l,0,_);const R=p.map((g,E)=>({id:g.id,order_index:E}));try{await x.post("https://nathanpro.onrender.com/api/admin/course/reorder",{modules:R},{headers:{"admin-id":o}}),j(p)}catch{h("Failed to reorder modules")}},L=()=>{localStorage.removeItem("adminId"),window.location.href="/admin/login"},U=u.length,$=u.filter(s=>s.purchases.some(t=>t.product_type==="course"&&t.status==="completed")).length,D=u.filter(s=>s.purchases.some(t=>t.product_type==="ebook"&&t.status==="completed")).length,S=u.reduce((s,t)=>s+t.purchases.filter(r=>r.status==="completed").reduce((r,l)=>r+l.amount,0),0);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("div",{className:"bg-white shadow",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Dashboard"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>b("overview"),className:`px-4 py-2 rounded-md ${i==="overview"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Overview"}),e.jsx("button",{onClick:()=>b("users"),className:`px-4 py-2 rounded-md ${i==="users"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Users"}),e.jsx("button",{onClick:()=>b("course"),className:`px-4 py-2 rounded-md ${i==="course"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Course Management"})]}),e.jsx("button",{onClick:L,className:"text-sm text-gray-600 hover:text-gray-800 underline",children:"Logout"})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[v&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:v}),C?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):e.jsxs(e.Fragment,{children:[i==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:U})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Courses Purchased"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:$})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Ebooks Purchased"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:D}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[w," downloads"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Total Revenue"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-600",children:["$",S.toFixed(2)]})]})]}),i==="users"&&e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Registered Users"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Registered"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Purchases"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Spent"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(s=>{const t=s.purchases.filter(r=>r.status==="completed").reduce((r,l)=>r+l.amount,0);return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex space-x-2",children:[s.purchases.some(r=>r.product_type==="course"&&r.status==="completed")&&e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"Course"}),s.purchases.some(r=>r.product_type==="ebook"&&r.status==="completed")&&e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:"Ebook"})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",t.toFixed(2)]})]},s.id)})})]})})]}),i==="course"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:a.moduleId?"Edit Module":"Add New Module"}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Module Title"}),e.jsx("input",{type:"text",value:a.title,onChange:s=>c({...a,title:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:s=>c({...a,description:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"YouTube URL"}),e.jsx("input",{type:"url",value:a.youtubeUrl,onChange:s=>c({...a,youtubeUrl:s.target.value}),placeholder:"https://www.youtube.com/watch?v=...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition",children:a.moduleId?"Update Module":"Add Module"}),a.moduleId&&e.jsx("button",{type:"button",onClick:()=>c({title:"",description:"",youtubeUrl:"",moduleId:null}),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition",children:"Cancel"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Course Modules"})}),e.jsx("div",{className:"p-6",children:d.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No modules added yet"}):e.jsx("div",{className:"space-y-4",children:d.map((s,t)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:[t+1,". ",s.title]}),s.description&&e.jsx("p",{className:"text-gray-600 mt-1",children:s.description}),e.jsxs("div",{className:"mt-2 flex items-center space-x-4 text-sm text-gray-500",children:[e.jsx("a",{href:s.youtube_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"View on YouTube"}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Video ID: ",s.youtube_video_id]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:()=>f(s.id,"up"),disabled:t===0,className:`p-1 rounded ${t===0?"text-gray-300 cursor-not-allowed":"text-gray-600 hover:bg-gray-100"}`,title:"Move up",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),e.jsx("button",{onClick:()=>f(s.id,"down"),disabled:t===d.length-1,className:`p-1 rounded ${t===d.length-1?"text-gray-300 cursor-not-allowed":"text-gray-600 hover:bg-gray-100"}`,title:"Move down",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),e.jsx("button",{onClick:()=>c({title:s.title,description:s.description,youtubeUrl:s.youtube_url,moduleId:s.id}),className:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:"Edit",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>I(s.id),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Delete",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},s.id))})})]})]})]})]})]})};export{T as default};
